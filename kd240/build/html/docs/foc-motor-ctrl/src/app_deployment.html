<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Board Setup and Application Deployment &mdash; Kria™ KD240 1.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Hardware Architecture of the Platform" href="hw_description.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../index.html" class="icon icon-home"> Kria™ KD240
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/Kria_doc_map/map.htm">Kria Adventure Map</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/freertos.html">FreeRTOS Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KD240 Applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../bist/bist_landing.html">BIST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ros2_multinode_communication_via_tsn/ros2_multinode_communication_via_tsn_landing.html">ROS 2 Multi-Node Communications Via TSN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../foc_motor_control_landing.html">FOC Motor Control Application</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../foc_motor_control_landing.html#overview">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../foc_motor_control_landing.html#quick-start">Quick Start</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Setting Up the Board and Application deployment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisite">Prerequisite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-the-firmware">Load the Firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-interfaces">Control Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-motor-control-dashboard-application">Run the Motor Control Dashboard Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#on-the-host-pc">On the Host PC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-motor-control-ros2-canopen-application">Run the Motor Control ROS2 CANopen Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-one-wire-temperature-sensor-demo">Run One Wire Temperature Sensor Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../foc_motor_control_landing.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../foc_motor_control_landing.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../foc_motor_control_landing.html#repository">Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../foc_motor_control_landing.html#other">Other</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KD240 Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../kria_starterkit_linux_boot.html">Booting Kria Starter Kit Linux on KD240</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_the_design.html">Building the Design Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_vivado_design.html">Building the Hardware Design Using Vivado</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generating_custom_firmware.html">Generate Custom Firmware</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Kria™ KD240</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../foc_motor_control_landing.html">FOC Motor Control Application</a> &raquo;</li>
      <li>Board Setup and Application Deployment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/foc-motor-ctrl/src/app_deployment.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="../../media/xilinx-logo.png" width="30%"/><h1> Kria&trade; KD240 Drives Starter Kit <br>FOC Motor Control Application Tutorial</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h1>Setting up the Board and Application Deployment</h1> </td>
 </tr>
</table><section id="board-setup-and-application-deployment">
<h1>Board Setup and Application Deployment<a class="headerlink" href="#board-setup-and-application-deployment" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This document shows how to set up the board, and run the motor control application.</p>
<p>This guide is targeted for Ubuntu® 22.04 and the AMD 2023.1 toolchain.</p>
</section>
<section id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Link to this heading">¶</a></h2>
<section id="hardware-requirements">
<h3>Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.xilinx.com/products/som/kria/kd240-drives-starter-kit.html">KD240 Drives Starter Kit</a></p></li>
<li><p><a class="reference external" href="https://www.xilinx.com/products/som/kria/kd240-motor-accessory-pack.html">KD240 Motor Accessory Kit</a></p></li>
<li><p>KD240 power supply and adapter (included with the KD240 Drives Starter Kit)</p>
<ul>
<li><p>12V AC adapter for the KD240 Starter Kit and 24V AC adapter for the Motor Accessory Kit</p></li>
</ul>
</li>
<li><p>USB-A to micro-B cable (included with the KD240 Drives Starter Kit)</p></li>
<li><p>MicroSD card (32 GB card is included with the KD240 Drives Starter Kit)</p></li>
<li><p>CAT6 Ethernet cable</p></li>
<li><p>Host machine with display</p></li>
<li><p><a class="reference external" href="https://www.adafruit.com/product/381?gad_source=1&amp;gclid=EAIaIQobChMI2IS22dqmhAMVIxWtBh1legB6EAQYASABEgKwIvD_BwE">One Wire Temperature Sensor</a></p></li>
</ul>
</section>
<section id="hardware-setup">
<h3>Hardware Setup<a class="headerlink" href="#hardware-setup" title="Link to this heading">¶</a></h3>
<p><img alt="KD240-Setup" src="../../../_images/KD240.png" /></p>
<ul>
<li><p>Connect the USB cable from the host machine to the J4 UART/JTAG interface on the board.</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_USB_to_J4.jpg" /></p>
</li>
<li><p>Connect the Ethernet cable from J24 to your local network with DHCP enabled to install the Linux packages.</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_Ethernet_to_J24.jpg" /></p>
</li>
<li><p>Connect a 12V power supply to the J12 DC jack.</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_12V_to_J12.jpg" /></p>
</li>
<li><p>Connect a 24V power supply to the J29 DC link connector.</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_24V_to_J29.jpg" /></p>
</li>
<li><p>Connect the encoder header pins to the J42 QEI connector. Ensure J44 is in the “SE” selection.</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_EncoderPin_to_J42.jpg" /></p>
</li>
<li><p>Connect the motor input to a J32 3-phase inverter connector.</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_ACpower_to_J32.jpg" /></p>
</li>
<li><p>Connect the One Wire Temperature Sensor to J47 Temp Sensor connector. Red connects to 3-5V, Blue/Black
connects to ground and Yellow/White is Sense(data)</p>
<p><img alt="KD240-Setup" src="../../../_images/Connect_OneWire_to_J47.jpg" /></p>
</li>
<li><p>Only for CANopen server interface: Connect PMOD-CAN module to PMOD3 on the
KR260. Connect CAN cables from J18 on the KD240 to the PMOD-CAN module (CANL
to CANL, CANH to CANH, GND to GND).</p>
<p><img alt="KD240-KR260-CAN" src="../../../_images/KD240_KR260_CAN.jpg" /></p>
</li>
</ul>
</section>
<section id="tested-artifacts">
<h3>Tested Artifacts<a class="headerlink" href="#tested-artifacts" title="Link to this heading">¶</a></h3>
<p>Testing was performed with the following artifacts:</p>
<section id="kd240-platform-artifacts">
<h4>KD240 platform Artifacts<a class="headerlink" href="#kd240-platform-artifacts" title="Link to this heading">¶</a></h4>
<table border="1" class="docutils">
<thead>
<tr>
<th>Component</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boot Firmware</td>
<td>K24-BootFW-01.01</td>
</tr>
<tr>
<td>Linux Kernel</td>
<td>5.15.0-1030-xilinx-zynqmp</td>
</tr>
<tr>
<td>xlnx-firmware-kd240-motor-ctrl</td>
<td>0.12-0xlnx2</td>
</tr>
</tbody>
</table><p>To obtain the latest Linux image and boot firmware, refer to the <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#Boot-Firmware-Updates">Kria Wiki</a>.</p>
</section>
<section id="application-packages">
<h4>Application Packages<a class="headerlink" href="#application-packages" title="Link to this heading">¶</a></h4>
<table border="1" class="docutils">
<thead>
<tr>
<th>Package</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>xlnx-app-kd240-foc-motor-ctrl</td>
<td>0.4-0xlnx1</td>
</tr>
</tbody>
</table></section>
</section>
<section id="initial-setup">
<h3>Initial Setup<a class="headerlink" href="#initial-setup" title="Link to this heading">¶</a></h3>
<ol>
<li><p>Go through <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240/linux_boot.html">Booting Kria Starter Kit Linux</a> to complete the minimum setup required to boot Linux before continuing with instructions on this page.</p></li>
<li><p>Get the latest motor control application and firmware package:</p>
<ul>
<li><p>Download the firmware.</p>
<ul>
<li><p>Search package feed for packages compatible with the KD240.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@kria:~$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>search<span class="w"> </span>xlnx-firmware-kd240
Sorting...<span class="w"> </span>Done
Full<span class="w"> </span>Text<span class="w"> </span>Search...<span class="w"> </span>Done
xlnx-firmware-kd240-bist/jammy,now<span class="w"> </span><span class="m">0</span>.10-0xlnx1<span class="w"> </span>arm64<span class="w"> </span><span class="o">[</span>installed<span class="o">]</span>
FPGA<span class="w"> </span>firmware<span class="w"> </span><span class="k">for</span><span class="w"> </span>Xilinx<span class="w"> </span>boards<span class="w"> </span>-<span class="w"> </span>kd240<span class="w"> </span>bist<span class="w"> </span>application
xlnx-firmware-kd240-motor-ctrl-qei/jammy,now<span class="w"> </span><span class="m">0</span>.10-0xlnx1<span class="w"> </span>arm64<span class="w"> </span><span class="o">[</span>installed<span class="o">]</span>
FPGA<span class="w"> </span>firmware<span class="w"> </span><span class="k">for</span><span class="w"> </span>Xilinx<span class="w"> </span>boards<span class="w"> </span>-<span class="w"> </span>kd240<span class="w"> </span>motor-ctrl-qei<span class="w"> </span>application
</pre></div>
</div>
</li>
<li><p>Install the firmware binaries.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>xlnx-firmware-kd240-motor-ctrl-qei
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Install the motor control application.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add lely PPA for lely-core libraries</span>
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>ppa:lely/ppa
sudo<span class="w"> </span>apt-get<span class="w"> </span>update

sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>xlnx-app-kd240-foc-motor-ctrl
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Install lm-sensors package for One Wire Temperature sensor</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>lm-sensors
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="load-the-firmware">
<h2>Load the Firmware<a class="headerlink" href="#load-the-firmware" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Show the list and status of available application firmware.</p>
<p>After installing the firmware, execute xmutil listapps to verify that it is captured under the listapps function and to have dfx-mgrd rescan and register all accelerators in the firmware directory tree.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@kria:~$<span class="w"> </span>sudo<span class="w"> </span>xmutil<span class="w"> </span>listapps
<span class="w">       </span>Accelerator<span class="w">          </span>Accel_type<span class="w">                 </span>Base<span class="w">           </span>Base_type<span class="w">      </span><span class="c1">#slots(PL+AIE)    Active_slot</span>

<span class="w">  </span>kd240-motor-ctrl-qei<span class="w">       </span>XRT_FLAT<span class="w">         </span>kd240-motor-ctrl-qei<span class="w">     </span>XRT_FLAT<span class="w">            </span><span class="o">(</span><span class="m">0</span>+0<span class="o">)</span><span class="w">           </span>-1
</pre></div>
</div>
</li>
<li><p>Load the desired application firmware.</p>
<p>When there is already another accelerator/firmware loaded, unload it first, then load the kd240-foc-motor-ctrl firmware.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>xmutil<span class="w"> </span>unloadapp
sudo<span class="w"> </span>xmutil<span class="w"> </span>loadapp<span class="w"> </span>kd240-motor-ctrl-qei
</pre></div>
</div>
</li>
</ul>
</section>
<section id="control-interfaces">
<h2>Control Interfaces<a class="headerlink" href="#control-interfaces" title="Link to this heading">¶</a></h2>
<p>This application provides two interfaces to control the motor. The dashboard
application allows the user to control the motor and view live plots via a
web-based dashboard running on the KD240. The CANopen application allows the
user to start a CANopen server on the KD240 and control the motor via service
calls from another device over the CAN bus. The steps for both control
interfaces are described in more detail below.</p>
<p>Note: Only one interface can used at a time.</p>
</section>
<section id="run-the-motor-control-dashboard-application">
<h2>Run the Motor Control Dashboard Application<a class="headerlink" href="#run-the-motor-control-dashboard-application" title="Link to this heading">¶</a></h2>
<section id="on-the-kd240">
<h3>On the KD240<a class="headerlink" href="#on-the-kd240" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Run the bokeh server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the application to launch bokeh server for the dashboard</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>:/opt/xilinx/xlnx-app-kd240-foc-motor-ctrl/bin
start_motor_dashboard
<span class="c1"># Enter the sudo password if required and note the ip address of the board</span>
</pre></div>
</div>
<p>Sample screenshot of the terminal on launching the motor dashboard.</p>
<p><img alt="Terminal" src="../../../_images/terminal.png" /></p>
</li>
<li><p>Change Motor Configurations:</p>
<p>By default the motor configuration parameters are provided by <code class="docutils literal notranslate"><span class="pre">/etc/motor-control/config</span></code> file.
The configuration file stores various parameters required for motor control. These parameters include general
motor settings, voltage and mode configurations, PWM settings, gain parameters, and other calibration settings.
This allows for flexible and precise configuration of different motors by simply adjusting these parameters in
the config file. One can point to a different configuration file by passing additional argument to the bokeh server
allowing to use different configuration files for different motors.</p>
<p>To run the Bokeh server with a specific configuration file, use the following command structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>bokeh<span class="w"> </span>serve<span class="w"> </span>--show<span class="w"> </span>--allow-websocket-origin<span class="o">=</span>&lt;ip&gt;:5006<span class="w"> </span>mc_bokeh.py<span class="w"> </span>--args<span class="w"> </span>&lt;/path/to/config/file&gt;
</pre></div>
</div>
<p>Replace <ip> with board <code class="docutils literal notranslate"><span class="pre">ip</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;path/to/config/file&gt;</span></code> with the actual path to the desired configuration file.</p>
<blockquote>
<div><p>Note: If no path is specified, the default configuration file <a class="reference external" href="https://github.com/Xilinx/foc-motor-ctrl/blob/main/lib/configs/anaheim.config">anaheim.config</a> will be used. Inline comments in the config file explains each parameter.</p>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="on-the-host-pc">
<h2>On the Host PC<a class="headerlink" href="#on-the-host-pc" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Open &lt;ip&gt;:5006 in a web browser.</p>
<blockquote>
<div><p><strong>NOTE:</strong> Once the server is running, it retains its settings no matter how many times the browser is closed, opened, or refreshed.</p>
</div></blockquote>
</li>
<li><p>The system is set to OFF mode/state on starting the dashboard, observe the blue LED DS10 is off.</p></li>
<li><p>If the unit is plugged into a network with DHCP, an IP will be assigned automatically. If not on a network, then configure a static IP. For help on setting up static IP, see <a class="reference external" href="https://github.com/Xilinx/vck190-base-trd/blob/2022.1/docs/source/run/run-dashboard.rst#setting-up-a-private-network">Setting up a private network</a>.</p></li>
</ul>
<blockquote>
<div><p><strong>NOTE:</strong> The open-loop mode of motor operation is a test mode intended for users with motor control knowledge and experience. Incorrect configurations of values of Vd and Vq can cause the motor to spin at speeds higher than its rating and potentially cause excessive motor heating. Use caution when using the open-loop mode.</p>
</div></blockquote>
<section id="dashboard-features">
<h3>Dashboard Features<a class="headerlink" href="#dashboard-features" title="Link to this heading">¶</a></h3>
<ul>
<li><p>The Mode drop-down is used to select the control system mode of operation.</p></li>
<li><p>The Sample Size text box is used to indicate how many samples are collected and plotted on the graphs for each type of data. The samples are collected at 100 microsecond intervals. The maximum number of samples is limited to 3000 due to dashboard performance limitations. For a large number of samples, there might be a small delay before a dashboard command takes effect.</p></li>
<li><p>The Refresh Interval text box is used to indicate how often the dashboard plots will refresh. A minimum refresh interval will be enforced based on the current sample size (a larger sample size requires a larger refresh interval).</p></li>
<li><p>The gain text boxes are used to adjust the proportional and integral gains of the corresponding control loop.</p></li>
<li><p>The Speed Setpoint text box is used to set the speed setpoint when running the motor in speed mode. The valid range of speed setpoints is -10000 to 10000 rpm.</p></li>
<li><p>The Torque Setpoint text box is used to set the torque setpoint when running the motor in torque mode. The valid range of torque setpoints is -2.5 to 2.5 amps.</p></li>
<li><p>The Open Loop - Vd text box is used to set the  direct voltage (Vd). The valid range for Vd is -24 to 24 volts.</p>
<blockquote>
<div><p><strong>NOTE:</strong> Normally this should be set to ~0V.</p>
</div></blockquote>
</li>
<li><p>The Open Loop - Vq text box is used to set the quadrature voltage (Vq). The valid range for Vq is -24 to 24 volts.</p></li>
<li><p>The Fault Status indicators show if any faults have occured. When a critical fault occurs, the corresponding indicator will turn red. For a warning level faults, the corresponding indicator will turn yellow.</p></li>
<li><p>The Clear Faults button is used to clear all faults and put the system into Off mode.</p></li>
<li><p>The Electrical Data plot shows the currents and voltages for Phase A, B, and C. The voltage lines are hidden by default. The visibility of each current and voltage line can be toggled by clicking the legend labels. The current axis is shown on the left if any current lines are visible, and the voltage axis is shown on the right is any voltage lines are visible.</p></li>
<li><p>The Mechanical Data plot shows the speed and position of the motor. The visibility of each line can be toggled by clicking on the legend labels. The speed axis is shown on the left is speed is visible and the position axis is shown on the right if position is visible.</p></li>
<li><p>The Live Analysis plot shows the data that is selected for each axis using the buttons on the right.</p></li>
</ul>
<p>When the dashboard is first launched, the system will be in Off mode, and the dashboard will look similar to the following image. Observe that the electrical readings are near zero.</p>
<p><img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_Off.png" /></p>
<p>To run the application in Speed mode, select <strong>Speed</strong> from the Mode drop-down, and use the Speed Setpoint text box to enter a speed setpoint. The following image shows the motor running in speed mode with a speed setpoint of 2000 rpm and the load disk that is included in the Motor Accessory Kit.</p>
<p><img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_Speed.png" /></p>
<p>To run the application in Torque mode, select <strong>Torque</strong> from the Mode drop-down and use the Torque Setpoint text box to enter a torque setpoint. The following image shows the motor running in torque mode with a torque setpoint of 1 amp and the load disk that is included in the Motor Accessory Kit.</p>
<p><img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_Torque.png" /></p>
<p>To run the application in Open Loop mode, select <strong>Open Loop</strong> from the Mode drop-down, and use the Vd/Vq text boxes to set Vd/Vq. The following image shows the motor running in open loop mode with Vd set to 0, Vq set to 4 volts, and the load disk that is included in the Motor Accessory Kit.</p>
<p><img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_OpenLoop.png" /></p>
<p>The following images show what the dashboard looks like when a larger load is applied to the motor. As the load on the motor increases, the currents will increase and the I_alpha/I_beta circle will expand.</p>
<p><img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_Speed_Loaded.png" />
<img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_Torque_Loaded.png" />
<img alt="Motor-Control-Dashboard" src="../../../_images/Motor_Control_Dashboard_OpenLoop_Loaded.png" /></p>
</section>
</section>
<section id="run-the-motor-control-ros2-canopen-application">
<h2>Run the Motor Control ROS2 CANopen Application<a class="headerlink" href="#run-the-motor-control-ros2-canopen-application" title="Link to this heading">¶</a></h2>
<section id="test-can-communication">
<h3>Test CAN Communication<a class="headerlink" href="#test-can-communication" title="Link to this heading">¶</a></h3>
<ul>
<li><p>On the KR260, go through <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260/build/html/docs/kria_starterkit_linux_boot.html">Booting Kria Starter Kit Linux</a> to complete the minimum setup required to boot Linux before continuing with instructions on this page.</p></li>
<li><p>Install and load firmware on KR260. The kr260-tsn-rs485pmod firmware is used
to enable to PMOD-CAN interface on KR260.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>xlnx-firmware-kr260-tsn-rs485pmod
sudo<span class="w"> </span>xmutil<span class="w"> </span>unloadapp
sudo<span class="w"> </span>xmutil<span class="w"> </span>loadapp<span class="w"> </span>kr260-tsn-rs485pmod
</pre></div>
</div>
</li>
<li><p>Set up the CAN interface on both the KR260 and KD240.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>can0<span class="w"> </span>up<span class="w"> </span><span class="nb">type</span><span class="w"> </span>can<span class="w"> </span>bitrate<span class="w"> </span><span class="m">100000</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>can0<span class="w"> </span>txqueuelen<span class="w"> </span><span class="m">10000</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>can0<span class="w"> </span>up
</pre></div>
</div>
</li>
<li><p>Verify the CAN interface state</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip<span class="w"> </span>-d<span class="w"> </span>-s<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>can0
</pre></div>
</div>
</li>
<li><p>Install can-utils on both the KR260 and KD240.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>can-utils
</pre></div>
</div>
</li>
<li><p>On one board, run candump.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>candump<span class="w"> </span>can0
</pre></div>
</div>
</li>
<li><p>On the other board, use cansend to send test data. You should see this data
show up on the board running candump.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>cansend<span class="w"> </span>can0<span class="w"> </span><span class="m">123</span><span class="c1">#1122334455667788</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id1">
<h3>On the KD240<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Run the CANopen application.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>:/opt/xilinx/xlnx-app-kd240-foc-motor-ctrl/bin
start_motor_server
</pre></div>
</div>
</li>
<li><p>To terminate the server</p>
<p>If it is required to kill the server kill fmc_canopen application</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>killall<span class="w">  </span>fmc_canopen
</pre></div>
</div>
</li>
</ul>
</section>
<section id="on-the-kr260-master">
<h3>On the KR260 (master)<a class="headerlink" href="#on-the-kr260-master" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Download the docker image on the KR260.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>xilinx/foc-motor-ctrl-ros2-canopen-host:latest
</pre></div>
</div>
</li>
<li><p>You can find the images installed with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>images
</pre></div>
</div>
</li>
<li><p>Launch the docker container on the KR260.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="o">=</span>DISPLAY<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="o">=</span>XDG_SESSION_TYPE<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--net<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--privileged<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--volume<span class="o">=</span>/home/ubuntu/.Xauthority:/root/.Xauthority:rw<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="o">=</span>motor_control<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/tmp:/tmp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/dev:/dev<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/sys:/sys<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/etc/vart.conf:/etc/vart.conf<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/lib/firmware/xilinx:/lib/firmware/xilinx<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/run:/run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-it<span class="w"> </span>xilinx/foc-motor-ctrl-ros2-canopen-host:latest<span class="w"> </span>bash
</pre></div>
</div>
</li>
<li><p>Inside the container, run canopen host tests using the launch file described in the following
subsections. There are 2 tests:</p>
<ul class="simple">
<li><p><em>Simple CiA402 system</em>: where host accesses motor directly using ros2_canopen 402 driver.</p></li>
<li><p><em>ROS2 Control example</em>: where host accesses motor over ros2_control interface.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong>: Do not run both the launch files together as they will interfere in the operations. Only one test can be running at a given time.</p>
</div></blockquote>
</li>
</ul>
<section id="run-a-simple-cia402-system-host">
<h4>Run a simple CiA402 system host<a class="headerlink" href="#run-a-simple-cia402-system-host" title="Link to this heading">¶</a></h4>
<ul>
<li><p>In the docker run terminal start the canopen 402 host ros container using the launch file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>kria_motor_control<span class="w"> </span>kd240.system.launch.py
</pre></div>
</div>
</li>
<li><p>Open a new terminal, start another session of the the same container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>motor_control<span class="w"> </span>bash
</pre></div>
</div>
</li>
<li><p>Check the available services and their types.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>list<span class="w"> </span>-t
</pre></div>
</div>
<p>The output should look similar to this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@KR260:~$<span class="w"> </span>ros2<span class="w"> </span>service<span class="w"> </span>list<span class="w"> </span>-t
/device_container_node/change_state<span class="w"> </span><span class="o">[</span>lifecycle_msgs/srv/ChangeState<span class="o">]</span>
/device_container_node/describe_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/DescribeParameters<span class="o">]</span>
/device_container_node/get_parameter_types<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameterTypes<span class="o">]</span>
/device_container_node/get_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameters<span class="o">]</span>
/device_container_node/init_driver<span class="w"> </span><span class="o">[</span>canopen_interfaces/srv/CONode<span class="o">]</span>
/device_container_node/list_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/ListParameters<span class="o">]</span>
/device_container_node/set_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParameters<span class="o">]</span>
/device_container_node/set_parameters_atomically<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParametersAtomically<span class="o">]</span>
/kd240/cyclic_position_mode<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/cyclic_velocity_mode<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/describe_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/DescribeParameters<span class="o">]</span>
/kd240/get_parameter_types<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameterTypes<span class="o">]</span>
/kd240/get_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameters<span class="o">]</span>
/kd240/halt<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/init<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/interpolated_position_mode<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/list_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/ListParameters<span class="o">]</span>
/kd240/nmt_reset_node<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/nmt_start_node<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/position_mode<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/recover<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/sdo_read<span class="w"> </span><span class="o">[</span>canopen_interfaces/srv/CORead<span class="o">]</span>
/kd240/sdo_write<span class="w"> </span><span class="o">[</span>canopen_interfaces/srv/COWrite<span class="o">]</span>
/kd240/set_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParameters<span class="o">]</span>
/kd240/set_parameters_atomically<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParametersAtomically<span class="o">]</span>
/kd240/target<span class="w"> </span><span class="o">[</span>canopen_interfaces/srv/COTargetDouble<span class="o">]</span>
/kd240/torque_mode<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/kd240/velocity_mode<span class="w"> </span><span class="o">[</span>std_srvs/srv/Trigger<span class="o">]</span>
/launch_ros_33646/describe_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/DescribeParameters<span class="o">]</span>
/launch_ros_33646/get_parameter_types<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameterTypes<span class="o">]</span>
/launch_ros_33646/get_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameters<span class="o">]</span>
/launch_ros_33646/list_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/ListParameters<span class="o">]</span>
/launch_ros_33646/set_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParameters<span class="o">]</span>
/launch_ros_33646/set_parameters_atomically<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParametersAtomically<span class="o">]</span>
/master/describe_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/DescribeParameters<span class="o">]</span>
/master/get_parameter_types<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameterTypes<span class="o">]</span>
/master/get_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/GetParameters<span class="o">]</span>
/master/list_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/ListParameters<span class="o">]</span>
/master/sdo_read<span class="w"> </span><span class="o">[</span>canopen_interfaces/srv/COReadID<span class="o">]</span>
/master/sdo_write<span class="w"> </span><span class="o">[</span>canopen_interfaces/srv/COWriteID<span class="o">]</span>
/master/set_parameters<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParameters<span class="o">]</span>
/master/set_parameters_atomically<span class="w"> </span><span class="o">[</span>rcl_interfaces/srv/SetParametersAtomically<span class="o">]</span>
</pre></div>
</div>
</li>
<li><p>To view an interface definition, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>&lt;type&gt;
</pre></div>
</div>
<p>For example, to view the interface definition for the canopen_interfaces/srv/COTargetDouble
type which is used for the /kd240/target service, run the command below.
This will print the input (target) and output (success).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@KR260:~$<span class="w"> </span>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>canopen_interfaces/srv/COTargetDouble
float64<span class="w"> </span>target
---
bool<span class="w"> </span>success
</pre></div>
</div>
</li>
<li><p>Use service calls to control the motor.</p>
<p>The services available and their descriptions can be found in the
<a class="reference external" href="https://ros-industrial.github.io/ros2_canopen/manual/humble/user-guide/cia402-driver.html">Cia402 Driver documentation</a>.</p>
<p>Reset:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/kd240/nmt_reset_node<span class="w"> </span>std_srvs/srv/Trigger
</pre></div>
</div>
<p>Init:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/kd240/init<span class="w"> </span>std_srvs/srv/Trigger
</pre></div>
</div>
<p>Change to velocity mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/kd240/velocity_mode<span class="w"> </span>std_srvs/srv/Trigger
</pre></div>
</div>
<p>Change target speed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>service<span class="w"> </span>call<span class="w"> </span>/kd240/target<span class="w"> </span>canopen_interfaces/srv/COTargetDouble<span class="w"> </span><span class="s2">&quot;target: 3000&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong>: For the Anaheim motor kit, the speed range is 250 to 10000 rpm in
both directions. If the motor does not spin at 250 rpm, try a faster speed.
The minimum speed can vary by motor.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="run-a-ros2-control-based-example">
<h4>Run a ROS2 Control based example<a class="headerlink" href="#run-a-ros2-control-based-example" title="Link to this heading">¶</a></h4>
<ul>
<li><p>In the docker run terminal start the canopen 402 control system host using the launch file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>kria_motor_control<span class="w"> </span>kd240.ros2_control.launch.py
</pre></div>
</div>
</li>
<li><p>Open a new terminal, start another session of the the same container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>motor_control<span class="w"> </span>bash
</pre></div>
</div>
</li>
<li><p>List the available controllers using ros2 control cli utility</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>control<span class="w"> </span>list_controllers
</pre></div>
</div>
<p>The output should look similar to this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@KR260:~$<span class="w"> </span>ros2<span class="w"> </span>control<span class="w"> </span>list_controllers
forward_velocity_controller<span class="o">[</span>velocity_controllers/JointGroupVelocityController<span class="o">]</span><span class="w"> </span>active
joint_state_broadcaster<span class="o">[</span>joint_state_broadcaster/JointStateBroadcaster<span class="o">]</span><span class="w"> </span>active
</pre></div>
</div>
</li>
<li><p>To view the available hardware interfaces, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>control<span class="w"> </span>list_hardware_interfaces
</pre></div>
</div>
<p>The output should look similar to this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@KR260:~$<span class="w"> </span>ros2<span class="w"> </span>control<span class="w"> </span>list_hardware_interfaces
<span class="nb">command</span><span class="w"> </span>interfaces
<span class="w">        </span>wheel_joint/velocity<span class="w"> </span><span class="o">[</span>available<span class="o">]</span><span class="w"> </span><span class="o">[</span>claimed<span class="o">]</span>
state<span class="w"> </span>interfaces
<span class="w">        </span>wheel_joint/position
<span class="w">        </span>wheel_joint/velocity
</pre></div>
</div>
</li>
<li><p>List the Ros2 Topics</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@KR260:~$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span>list
/dynamic_joint_states
/forward_velocity_controller/commands
/forward_velocity_controller/transition_event
/joint_state_broadcaster/transition_event
/joint_states
/kd240_wheel/joint_states
/kd240_wheel/nmt_state
/kd240_wheel/rpdo
/kd240_wheel/tpdo
/parameter_events
/robot_description
/rosout
/tf
/tf_static
</pre></div>
</div>
</li>
<li><p>Observe the live state of the system using dynamic_joint_states</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w">  </span>/dynamic_joint_states
</pre></div>
</div>
<p>This continuously updates the current state of the system and shows the position and speed of the motor.</p>
</li>
<li><p>Open a new terminal, start another session of the the same container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>motor_control<span class="w"> </span>bash
</pre></div>
</div>
</li>
<li><p>Update the speed of the motor using velocity controller in a new terminal</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>/forward_velocity_controller/commands<span class="w"> </span>std_msgs/msg/Float64MultiArray<span class="w"> </span><span class="s2">&quot;data: [5000]&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p><img alt="Ro2_control_demo" src="../../../_images/sw_ros2_control.png" /></p>
</section>
</section>
</section>
<section id="run-one-wire-temperature-sensor-demo">
<h2>Run One Wire Temperature Sensor Demo<a class="headerlink" href="#run-one-wire-temperature-sensor-demo" title="Link to this heading">¶</a></h2>
<ul>
<li><p>In this demo, the lm-sensors utility probes the One Wire Temperature sensor, reads and displays the captured temperature value on  the serial terminal.</p></li>
<li><p>Ensure to load the motor-ctrl-qei firmware before running the demo</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>xmutil<span class="w"> </span>unloadapp
sudo<span class="w"> </span>xmutil<span class="w"> </span>loadapp<span class="w"> </span>kd240-motor-ctrl-qei
</pre></div>
</div>
</li>
<li><p>Run a sanity check to verify if the 1-wire slave sensor has been probed successfully.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@kria:~$<span class="w"> </span>sudo<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;w1&#39;</span>
<span class="o">[</span><span class="w">  </span><span class="m">247</span>.023403<span class="o">]</span><span class="w"> </span>w1_master_driver<span class="w"> </span>w1_bus_master1:<span class="w"> </span>Attaching<span class="w"> </span>one<span class="w"> </span>wire<span class="w"> </span>slave<span class="w"> </span><span class="m">28</span>.00000f0559bc<span class="w"> </span>crc<span class="w"> </span>dc
</pre></div>
</div>
</li>
<li><p>You can also check if the slave entry is added under <code class="docutils literal notranslate"><span class="pre">/sys/bus/w1/devices</span></code> and if master bus also registers this slave.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@kria:/sys/bus/w1/devices$<span class="w"> </span>ls
<span class="m">28</span>-00000f0559bc<span class="w">  </span>w1_bus_master1

ubuntu@kria:/sys/bus/w1/devices$<span class="w"> </span>cat<span class="w"> </span><span class="m">28</span>-00000f0559bc/name
<span class="m">28</span>-00000f0559bc
ubuntu@kria:/sys/bus/w1/devices$<span class="w"> </span>ls<span class="w"> </span><span class="m">28</span>-00000f0559bc
alarms<span class="w">     </span>eeprom_cmd<span class="w">  </span>hwmon<span class="w">  </span>power<span class="w">       </span>temperature
conv_time<span class="w">  </span>ext_power<span class="w">   </span>id<span class="w">     </span>resolution<span class="w">  </span>uevent
driver<span class="w">     </span>features<span class="w">    </span>name<span class="w">   </span>subsystem<span class="w">   </span>w1_slave

ubuntu@kria:/sys/bus/w1/devices/w1_bus_master1$<span class="w"> </span>cat<span class="w"> </span>w1_master_slave_count
<span class="m">1</span>
ubuntu@kria:/sys/bus/w1/devices/w1_bus_master1$<span class="w"> </span>cat<span class="w"> </span>w1_master_slaves
<span class="m">28</span>-00000f0559bc
</pre></div>
</div>
</li>
<li><p>You can also read the temperature through the filesystem</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@kria:~$<span class="w"> </span>ls<span class="w"> </span>/sys/class/hwmon/
hwmon0<span class="w">  </span>hwmon1<span class="w">  </span>hwmon2<span class="w">  </span>hwmon3

ubuntu@kria:~$<span class="w"> </span>cat<span class="w"> </span>/sys/class/hwmon/hwmon3/name
w1_slave_temp

ubuntu@kria:~$<span class="w"> </span>cat<span class="w"> </span>/sys/class/hwmon/hwmon3/temp1_input
<span class="m">20618</span>
</pre></div>
</div>
</li>
<li><p>The sensor read through the filesystem provides temperature in millidegrees Celsius</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">lm_sensors</span></code> utility’s <code class="docutils literal notranslate"><span class="pre">sensors</span></code> command gathers information from the kernel interfaces provided by <code class="docutils literal notranslate"><span class="pre">hwmon</span></code> subsystem, aggregates this raw data,
applies scaling and calibration and presents it in a human-readable format.</p></li>
<li><p>Run the 1-wire demo to measure temperature.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output should be the following</span>

ubuntu@kria:~$<span class="w"> </span>sensors
ina260_u3-isa-0000
Adapter:<span class="w"> </span>ISA<span class="w"> </span>adapter
in1:<span class="w">           </span><span class="m">5</span>.06<span class="w"> </span>V
power1:<span class="w">        </span><span class="m">2</span>.46<span class="w"> </span>W
curr1:<span class="w">       </span><span class="m">487</span>.00<span class="w"> </span>mA

ams-isa-0000
Adapter:<span class="w"> </span>ISA<span class="w"> </span>adapter
in1:<span class="w">           </span><span class="m">1</span>.21<span class="w"> </span>V
in2:<span class="w">           </span><span class="m">0</span>.00<span class="w"> </span>V
in3:<span class="w">         </span><span class="m">720</span>.00<span class="w"> </span>mV
in4:<span class="w">         </span><span class="m">848</span>.00<span class="w"> </span>mV
in5:<span class="w">           </span><span class="m">1</span>.79<span class="w"> </span>V
in6:<span class="w">           </span><span class="m">1</span>.79<span class="w"> </span>V
in7:<span class="w">         </span><span class="m">852</span>.00<span class="w"> </span>mV
in8:<span class="w">         </span><span class="m">848</span>.00<span class="w"> </span>mV
in9:<span class="w">         </span><span class="m">849</span>.00<span class="w"> </span>mV
in10:<span class="w">          </span><span class="m">1</span>.80<span class="w"> </span>V
in11:<span class="w">          </span><span class="m">1</span>.09<span class="w"> </span>V
in12:<span class="w">          </span><span class="m">1</span>.79<span class="w"> </span>V
in13:<span class="w">          </span><span class="m">1</span>.79<span class="w"> </span>V
in14:<span class="w">          </span><span class="m">1</span>.79<span class="w"> </span>V
in15:<span class="w">          </span><span class="m">1</span>.79<span class="w"> </span>V
in16:<span class="w">        </span><span class="m">850</span>.00<span class="w"> </span>mV
in17:<span class="w">          </span><span class="m">1</span>.80<span class="w"> </span>V
in18:<span class="w">        </span><span class="m">598</span>.00<span class="w"> </span>mV
in19:<span class="w">        </span><span class="m">718</span>.00<span class="w"> </span>mV
in20:<span class="w">          </span><span class="m">1</span>.80<span class="w"> </span>V
in21:<span class="w">          </span><span class="m">1</span>.25<span class="w"> </span>V
in22:<span class="w">          </span><span class="m">0</span>.00<span class="w"> </span>V
in23:<span class="w">        </span><span class="m">846</span>.00<span class="w"> </span>mV
in24:<span class="w">        </span><span class="m">846</span>.00<span class="w"> </span>mV
in25:<span class="w">        </span><span class="m">852</span>.00<span class="w"> </span>mV
in26:<span class="w">          </span><span class="m">1</span>.80<span class="w"> </span>V
in27:<span class="w">        </span><span class="m">601</span>.00<span class="w"> </span>mV
temp1:<span class="w">        </span>+25.1°C
temp2:<span class="w">        </span>+26.5°C
temp3:<span class="w">        </span>+27.1°C

w1_slave_temp-virtual-0
Adapter:<span class="w"> </span>Virtual<span class="w"> </span>device
temp1:<span class="w">        </span>+20.6°C
</pre></div>
</div>
</li>
<li><p>The output will have multiple sensors and <code class="docutils literal notranslate"><span class="pre">w1_slave_temp-virtual</span></code> is the desired One Wire Temperature Sensor value that is connected to KD240.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Go back to the <a class="reference internal" href="../foc_motor_control_landing.html"><span class="doc">KD240 FOC Motor Control Application Start Page</span></a></p></li>
</ul>
<!---

Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License.

You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.

--><p class="sphinxhide" align="center">Copyright&copy; 2023 Advanced Micro Devices, Inc</p></section>
</section>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hw_description.html" class="btn btn-neutral float-right" title="Hardware Architecture of the Platform" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on July 09, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>